<!DOCTYPE html>
<html>
	<head>
	 <meta charset="UTF-8">
		<title>ok</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<h1 id="ok">something</h1>
		<form id="form" method="GET" action="/search-results">
			<ol id="ol-current"></ol>
			<ol id="ol-destination"></ol>
			<label for="departureDate">Departure Date</label>
			<input type="date" id="departureDate" name="departureDate"/>
			<label for="adults">Number of Adults:</label>
			<input type="number" id="adults" name="adults" />
			<label for="travelClass">Class</label>
			<select id="travelClass" name="travelClass">
				<option value="ECONOMY">Economy</option>
				<option value="PREMIUM_ECONOMY">Premium Economy</option>
				<option value="BUSINESS">Business</option>
				<option value="FIRST">First</option>
			</select>
			<label for="nonStop">Non-Stop?</label>
			<input type="radio" id="nonStop" name="nonStop" value="true" />
			<label for="connected">Connected?</label>
			<input type="radio" id="connected" name="nonStop" value="false" />
			<label for="maxPrice">Max Price</label>
			<input type="number" id="maxPrice" name="maxPrice" />
			<button type="submit">button</button>
		</form>
		<script>
			var urlParams = new URLSearchParams(window.location.search);
			var latitude_query = urlParams.get('latitude');
			var longitude_query = urlParams.get('longitude');
			var radius_query = urlParams.get('radius');
			var destination_latitude_query = urlParams.get('destination-latitude');
			var destination_longitude_query = urlParams.get('destination-longitude');
			var destination_radius_query = urlParams.get('destination-radius')
			console.log(latitude_query, longitude_query, radius_query, destination_latitude_query, destination_longitude_query, destination_radius_query);
			
			var form = document.getElementById("form");
			var ol_current = document.getElementById("ol-current");
			var ol_destination = document.getElementById("ol-destination");
			async function AirportsNearest(latitude_query, longitude_query, radius_query, current=true) {
				var url = "https://test.api.amadeus.com/v1/reference-data/locations/airports?latitude=" + latitude_query + "&longitude=" + longitude_query + "&radius=" + radius_query;
				console.log(url);
				var access_token = "vRrmr1l14nKpeJAV9Q8JA2X5yore";
				var response = await fetch(url, {
					method: 'GET', 
					headers: {
						'Authorization': 'Bearer ' + access_token
					}
				});
				var json = await response.json();
				var airports = json.data;
				console.log(airports.length)
				if (current) {
					for (let index in airports) {
						var li = document.createElement("li");
						var radio = document.createElement("input");
						var label = document.createElement("label");
						li.innerText = `${airports[index].name}, ${airports[index].distance.value} away`;
						label.innerText = "Choose your takeoff airport";
						radio.setAttribute("type", "radio");
						radio.setAttribute("name", "originLocationCode");
						radio.setAttribute("id", `${airports[index].iataCode}`);
						radio.setAttribute("value", `${airports[index].iataCode}`);
						label.setAttribute("for", `${airports[index].iataCode}`);
						li.appendChild(label);
						li.appendChild(radio);
						ol_current.appendChild(li);
					}
				} else {
					for (let index in airports) {
						var li = document.createElement("li");
						var radio = document.createElement("input");
						var label = document.createElement("label");
						li.innerText = `${airports[index].name}, ${airports[index].distance.value} away`;
						label.innerText = "Choose your takeoff airport";
						radio.setAttribute("type", "radio");
						radio.setAttribute("name", "destinationLocationCode");
						radio.setAttribute("id", `${airports[index].iataCode}`);
						radio.setAttribute("value", `${airports[index].iataCode}`);
						label.setAttribute("for", `${airports[index].iataCode}`);
						li.appendChild(label);
						li.appendChild(radio);
						ol_destination.appendChild(li);
					}
				}
			}
			
			window.onload = function () {
				AirportsNearest(latitude_query, longitude_query, radius_query);
				AirportsNearest(destination_latitude_query, destination_longitude_query, destination_radius_query, false);
			}
		</script>
	</body>
</html>