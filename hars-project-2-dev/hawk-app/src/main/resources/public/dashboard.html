<!DOCTYPE html>
<html>
	<head>
	 	<meta charset="UTF-8">
		<title>Dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<section id="main-section"></section>
		<ol id="ol"></ol>
		<script>
			var section = document.getElementById("main-section");
			var ol = document.getElementById("ol");
			
			async function reservations() {
				var url = "http://localhost:5000/api/reservations.json";
				var response = await fetch(url);
				var json = await response.json();
				for (let i = 0; i < json.length; i++) {
					var reservation_id = JSON.parse(json[i].id);
					var reservation = JSON.parse(json[i].reservationJSON);
					var li = document.createElement("li");
					var itineraries = reservation.itineraries;
					var grand_total = reservation.price.grandTotal;
					var h3 = document.createElement("h3");
					var a = document.createElement("a");
					a.setAttribute("href", `/api/seatmap-display/${reservation_id}`);
					a.innerText = "Select or edit your seats here!";
					h3.innerText = `Grand Total $${grand_total}`;
					var form = document.createElement("form");
					form.setAttribute("method", "post");
					form.setAttribute("action", `/api/reservations/${reservation_id}`);
					var input = document.createElement("input");
					input.setAttribute("name", `${reservation_id}`);
					input.style.display = "none";
					var button = document.createElement("button");
					button.setAttribute("type", "submit");
					button.innerText = "Delete reservation here (50% refund)";
					form.appendChild(input);
					form.appendChild(button);
					li.appendChild(h3);
					li.appendChild(a);
					li.appendChild(form);
					for (let itinerary_index in itineraries) {
						var div_itinerary = document.createElement("div");
						var segments = itineraries[itinerary_index].segments;
						var h4_duration = document.createElement("h4");
						var total_duration = itineraries[itinerary_index].duration;
						if (itinerary_index == 0) {
							h4_duration.innerText = `Total duration to the destination: ${total_duration}`;
						} else {
							h4_duration.innerText = `Total duration back to arrival: ${total_duration}`;
						}
						div_itinerary.appendChild(h4_duration);
						var ol_segment = document.createElement("ol");
						for (let segment_index in segments) {
							var li_segment = document.createElement("li");
							var carrier = segments[segment_index].carrierCode;
							var number = segments[segment_index].number;
							var duration = segments[segment_index].duration;
							var departure_time = segments[segment_index].departure.at;
							var departure_iata = segments[segment_index].departure.iataCode;
							var arrival_time = segments[segment_index].arrival.at;
							var arrival_iata = segments[segment_index].arrival.iataCode;
							var h4 = document.createElement("h4");
							h4.innerText = `Carrier information: ${carrier} ${number}`;
							var h5 = document.createElement("h5");
							h5.innerText = `Duration for this flight: ${duration}`;
							var p_departure = document.createElement("p");
							var p_arrival = document.createElement("p");
							p_departure.innerText = `Departing from ${departure_iata} at ${departure_time}`;
							p_arrival.innerText = `Arriving at ${arrival_iata} at ${arrival_time}`;
							li_segment.appendChild(h4);
							li_segment.appendChild(h5);
							li_segment.appendChild(p_departure);
							li_segment.appendChild(p_arrival);
							ol_segment.appendChild(li_segment);
						}
						div_itinerary.appendChild(ol_segment);
						li.appendChild(div_itinerary);
					}
					ol.appendChild(li);
				}
			}
			
			window.onload = function() {
				reservations();
			}
		</script>
	</body>
</html>