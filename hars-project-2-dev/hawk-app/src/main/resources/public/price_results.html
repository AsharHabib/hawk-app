<!DOCTYPE html>
<html>
	<head>
	 	<meta charset="UTF-8">
		<title>Proceed to checkout</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body id="ok">
		<button type="submit" id="button">Confirm Order<button>
		<a href="/api/create-order">Proceed to checkout</a>
		<script>
			var body = document.getElementById("ok");
			var form = document.getElementById("form");
			var button = document.getElementById("button");
			var cookieValue = document.cookie
							  .split('; ')
							  .find(row => row.startsWith('flight='))
							  .split('=')[1];
			var flight_search_offer = JSON.parse(cookieValue);
			flight_search_offer.disablePricing = true;
			flight_search_offer.paymentCardRequired = false;
			var flight_price_offer = {
				"data": {
					"type": "flight-offers-pricing",
					"flightOffers": [flight_search_offer]
				}
			};
			
			async function FlightOffersPrice() {
				var request_access = await RequestAccessToken();
				
				var url = "https://test.api.amadeus.com/v1/shopping/flight-offers/pricing?forceClass=false";
				var access_token = request_access.access_token;
				var response = await fetch(url, {
					method: 'POST', 
					headers: {
						'Authorization': 'Bearer ' + access_token,
						'Content-Type': 'application/json'
					}, 
					body: JSON.stringify(flight_price_offer)
				});
				var json = await response.json();
			}
			
			async function RequestAccessToken() {
				var request_access = await fetch('https://test.api.amadeus.com/v1/security/oauth2/token', {
				    method: 'POST',
				    body: new URLSearchParams({
				        'grant_type': 'client_credentials',
				        'client_id': 'OGORt5hAGLuW5GzewaxGCPFVNrKiB0WV',
				        'client_secret': 'ik6GIT6Y7ui09KcA'
				    })
				});
				var access_json = await request_access.json();
				return access_json;
			}
			
			button.onclick = function() {
				FlightOffersPrice();
			}
		</script>
	</body>
</html>