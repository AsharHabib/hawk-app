<!DOCTYPE html>
<html>
	<head>
	 	<meta charset="UTF-8">
		<title>Confirm Order</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<form method="POST" action="/airports" id="form">
			
		</form>
		<input type="text" />
			<input type="text" />
			<input type="text" />
			<input type="number" />
			<input type="password" />
			<button type="submit" id="button">Confirm Order</button>
		
		<script>
			var button = document.getElementById("button");
			var cookieValue = document.cookie
							  .split('=')[1];
			var flight_search_offer = JSON.parse(cookieValue);
			flight_search_offer.disablePricing = true;
			flight_search_offer.paymentCardRequired = false;
			var flight_create_order = {
				"data": {
					"type": "flight-order",
					"flightOffers": [flight_search_offer],
					"travelers": [
      {
        "id": "1",
        "dateOfBirth": "1982-01-16",
        "name": {
          "firstName": "JORGrE",
          "lastName": "GONZALES"
        },
        "gender": "MALE",
        "contact": {
          "emailAddress": "jorge.gonzales833@telefonica.es",
          "phones": [
            {
              "deviceType": "MOBILE",
              "countryCallingCode": "34",
              "number": "480080076"
            }
          ]
        },
        "documents": [
          {
            "documentType": "PASSPORT",
            "birthPlace": "Madrid",
            "issuanceLocation": "Madrid",
            "issuanceDate": "2015-04-14",
            "number": "00000000",
            "expiryDate": "2025-04-14",
            "issuanceCountry": "ES",
            "validityCountry": "ES",
            "nationality": "ES",
            "holder": true
          }
        ]
      }
      ],
      		"remarks": {
				      "general": [
				        {
				          "subType": "GENERAL_MISCELLANEOUS",
				          "text": "ONLINE BOOKING FROM INCREDIBLE VALUES"
				        }
				      ],
				      "airline": [
				      	{
							"subType": "OTHER_SERVICE_INFORMATION",
							"airlineCode": `${flight_search_offer.itineraries[0].segments[0].carrierCode}`,
				          "text": "TEXT"
						}
				      ]
				    }
				}
			};
			console.log(flight_create_order);
			async function CreateOrder() {
				var request_access = await RequestAccessToken();
				
				var url = "https://test.api.amadeus.com/v1/booking/flight-orders";
				var access_token = request_access.access_token;
				var response = await fetch(url, {
					method: 'POST', 
					headers: {
						'Authorization': 'Bearer ' + access_token,
						'Content-Type': 'application/json'
					}, 
					body: JSON.stringify(flight_create_order)
				});
				var json = await response.json();
				console.log(json);
				document.getElementById("form").innerText = JSON.stringify(json);
			}
			
			async function RequestAccessToken() {
				var request_access = await fetch('https://test.api.amadeus.com/v1/security/oauth2/token', {
				    method: 'POST',
				    body: new URLSearchParams({
				        'grant_type': 'client_credentials',
				        'client_id': 'OGORt5hAGLuW5GzewaxGCPFVNrKiB0WV',
				        'client_secret': 'ik6GIT6Y7ui09KcA'
				    })
				});
				var access_json = await request_access.json();
				return access_json;
			}
			
			button.onclick = function() {
				document.cookie = "flight=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/ SameSite=None; Secure;";
				CreateOrder();
			}
			
		</script>
	</body>
</html>